@page
@model CyberSecurityTraining.Areas.Admin.Pages.Companies.IndexModel
@{
    ViewData["Title"] = "Companies";
}

<!-- Success/Error Messages -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">
        <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
    </div>
}
@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger">
        <i class="fas fa-exclamation-circle"></i> @TempData["ErrorMessage"]
    </div>
}

<div class="breadcrumb">
    <a asp-area="Admin" asp-page="/Dashboard">Dashboard</a> / Companies
</div>

<div class="page-title">Companies</div>
<div class="page-subtitle">Manage organizations and their users</div>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div class="section-title">All Companies</div>
    <a asp-area="Admin" asp-page="/Companies/Create" class="btn">
        <i class="fas fa-plus"></i> Add New Company
    </a>
</div>

@if (Model.Companies.Any())
{
    <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Users</th>
                <th>Groups</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var company in Model.Companies)
            {
                <tr>
                    <td>@company.Name</td>
                    <td>@(company.Description ?? "N/A")</td>
                    <td>@company.Users.Count</td>
                    <td>@company.UserGroups.Count</td>
                    <td>@company.DateCreated.ToString("MMM dd, yyyy")</td>
                    <td>
                        <a asp-area="Admin" asp-page="/Companies/Details" asp-route-id="@company.Id" class="btn btn-sm" title="View Details">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a asp-area="Admin" asp-page="/Companies/Edit" asp-route-id="@company.Id" class="btn btn-sm" title="Edit">
                            <i class="fas fa-edit"></i>
                        </a>
                        <button onclick="confirmDelete(@company.Id, '@company.Name')" class="btn btn-sm" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <div class="text-center" style="padding: 4rem 0;">
        <i class="fas fa-building" style="font-size: 48px; color: var(--text-light); margin-bottom: 1.5rem;"></i>
        <h3>No Companies Found</h3>
        <p style="color: var(--text-light); margin-bottom: 2rem;">Get started by creating your first company.</p>
        <a asp-area="Admin" asp-page="/Companies/Create" class="btn">
            <i class="fas fa-plus"></i> Create Company
        </a>
    </div>
}

<!-- Ultra-minimalist Delete Confirmation Dialog -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div style="background: var(--bg); border: 1px solid var(--border); max-width: 400px; margin: 2rem; padding: 0;">
        <div style="padding: 2rem 2rem 1rem 2rem;">
            <h3 style="margin: 0 0 1rem 0; font-size: 20px; font-weight: 400;">Confirm Delete</h3>
            <p style="margin: 0 0 1rem 0;">Are you sure you want to delete the company "<span id="companyName"></span>"?</p>
            <p style="color: var(--danger); margin: 0; font-size: 14px;"><strong>Warning:</strong> This action cannot be undone and will affect all associated users and groups.</p>
        </div>
        <div style="padding: 1rem 2rem 2rem 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
            <button type="button" onclick="hideDeleteModal()" class="btn btn-outline">Cancel</button>
            <form id="deleteForm" method="post" action="/Admin/Companies/Delete" style="display: inline; margin: 0;">
                <input type="hidden" id="deleteId" name="id" />
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmDelete(id, name) {
            document.getElementById('deleteId').value = id;
            document.getElementById('companyName').textContent = name;
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function hideDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.getElementById('deleteModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideDeleteModal();
            }
        });
    </script>
}
